name: 下班提醒

on:
  schedule:
    # 第一次提醒：北京时间17:50（UTC+8是9:50）
    - cron: '50 9 * * 1-5'
    # 第二次提醒：北京时间18:10（UTC+8是10:10）
    - cron: '10 10 * * 1-5'
  workflow_dispatch: # 允许手动触发测试

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: 发送企微提醒
        run: |
          # 获取当前UTC时间，用于判断是第一次还是第二次提醒
          CURRENT_HOUR=$(date -u +%H)
          CURRENT_MINUTE=$(date -u +%M)
          
          if [ "$CURRENT_HOUR" = "09" ] && [ "$CURRENT_MINUTE" = "50" ]; then
            MESSAGE="🕔 【第一次提醒】小伙伴们，还有10分钟下班！光速整理云效任务！~"
          else
            MESSAGE="🎉 【第二次提醒】下班啦！再检查一遍云效任务！~"
          fi
          
          curl -X POST \
            "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${{ secrets.WEBHOOK_KEY }}" \
            -H "Content-Type: application/json" \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"$MESSAGE\",
                \"mentioned_list\": [\"@all\"]
              }
            }"
