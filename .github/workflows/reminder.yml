name: 下班提醒

on:
  schedule:
    # 调整为17:45触发（UTC 09:45），预计17:50-17:55收到
    - cron: '45 9 * * 1-5'
    # 调整为18:05触发（UTC 10:05），预计18:10-18:15收到
    - cron: '05 10 * * 1-5'
  workflow_dispatch:

jobs:
  send-reminder:
    runs-on: ubuntu-latest
    steps:
      - name: 发送企微提醒
        run: |
          # 获取当前UTC时间来判断是哪次提醒
          CURRENT_HOUR=$(date -u +%H)
          CURRENT_MINUTE=$(date -u +%M)
          
          if [ "$CURRENT_HOUR" = "09" ] && [ "$CURRENT_MINUTE" = "45" ]; then
            MESSAGE="🕔 【重要提醒】小伙伴们，再次提醒！检查云效任务关闭情况以及工时登记（8小时）"
          else
            MESSAGE="🎉 【重要提醒】小伙伴们，再次提醒！检查云效任务关闭情况以及工时登记（8小时）"
          fi
          
          curl -X POST \
            "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=${{ secrets.WEBHOOK_KEY }}" \
            -H "Content-Type: application/json" \
            -d "{
              \"msgtype\": \"text\",
              \"text\": {
                \"content\": \"$MESSAGE\",
                \"mentioned_list\": [\"@all\"]
              }
            }"
